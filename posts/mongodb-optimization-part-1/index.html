<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="MongoDB Optimization Part 1" /><meta property="og:locale" content="en" /><meta name="description" content="As many before me, I was introduced to database systems in university, with a relational DBMS. I learned about normalization, transactions, ACID … the list goes on. So when I first heard of this mystical thing called a document database, which didn’t use SQL, which very publicly denounced normalization, I was a bit skeptical. How could a document database be better than a relational database? After all, relational databases have been around for a very long time, and have been used to build some of the most complex systems in the world. I thought it was just a fad, and that it would die out soon. But, oh boy, was I wrong. After working with mongo for a while, I have come to appreciate its simplicity and flexibility. In this post, I will try to recap a bit on database systems and start to delve into optimization tips and tricks for mongo." /><meta property="og:description" content="As many before me, I was introduced to database systems in university, with a relational DBMS. I learned about normalization, transactions, ACID … the list goes on. So when I first heard of this mystical thing called a document database, which didn’t use SQL, which very publicly denounced normalization, I was a bit skeptical. How could a document database be better than a relational database? After all, relational databases have been around for a very long time, and have been used to build some of the most complex systems in the world. I thought it was just a fad, and that it would die out soon. But, oh boy, was I wrong. After working with mongo for a while, I have come to appreciate its simplicity and flexibility. In this post, I will try to recap a bit on database systems and start to delve into optimization tips and tricks for mongo." /><link rel="canonical" href="https://blog.echo.et/posts/mongodb-optimization-part-1/" /><meta property="og:url" content="https://blog.echo.et/posts/mongodb-optimization-part-1/" /><meta property="og:site_name" content="A Scuba Blog by 0xecho" /><meta property="og:image" content="https://blog.echo.et/assets/2022-09/mongo.png" /><meta property="og:image:height" content="400" /><meta property="og:image:width" content="1000" /><meta property="og:image:alt" content="MongoDB Logo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-25T09:54:00+03:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://blog.echo.et/assets/2022-09/mongo.png" /><meta name="twitter:image:alt" content="MongoDB Logo" /><meta property="twitter:title" content="MongoDB Optimization Part 1" /><meta name="twitter:site" content="@0xecho" /><meta name="google-site-verification" content="MO4CCWjc_RhUutpASK6mHruJmg0TE99RP3lo1Nnh1mc" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-03T16:39:22+03:00","datePublished":"2022-09-25T09:54:00+03:00","description":"As many before me, I was introduced to database systems in university, with a relational DBMS. I learned about normalization, transactions, ACID … the list goes on. So when I first heard of this mystical thing called a document database, which didn’t use SQL, which very publicly denounced normalization, I was a bit skeptical. How could a document database be better than a relational database? After all, relational databases have been around for a very long time, and have been used to build some of the most complex systems in the world. I thought it was just a fad, and that it would die out soon. But, oh boy, was I wrong. After working with mongo for a while, I have come to appreciate its simplicity and flexibility. In this post, I will try to recap a bit on database systems and start to delve into optimization tips and tricks for mongo.","headline":"MongoDB Optimization Part 1","image":{"width":1000,"height":400,"alt":"MongoDB Logo","url":"https://blog.echo.et/assets/2022-09/mongo.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.echo.et/posts/mongodb-optimization-part-1/"},"url":"https://blog.echo.et/posts/mongodb-optimization-part-1/"}</script><title>MongoDB Optimization Part 1 | A Scuba Blog by 0xecho</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="A Scuba Blog by 0xecho"><meta name="application-name" content="A Scuba Blog by 0xecho"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/45893263?v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">A Scuba Blog by 0xecho</a></div><div class="site-subtitle font-italic">A collection of (seeminglly) random thoughts, ideas, experiences, and what not...</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/0xecho/" class="nav-link"> <i class="fa-fw fa fa-th ml-xl-3 mr-xl-3 unloaded"></i> <span>PORTFOLIO TYPE I</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/0xecho" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/0xecho" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['elias.amhat','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://linkedin.com/in/elijahma" aria-label="linkedin" target="_blank" rel="noopener noreferrer"> <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>MongoDB Optimization Part 1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>MongoDB Optimization Part 1</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1664088840" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 25, 2022 </em> </span> <span> Updated <em class="" data-ts="1664804362" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 3, 2022 </em> </span><div class="mt-3 mb-3"> <a href="/assets/2022-09/mongo.png" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/2022-09/mongo.png" alt="MongoDB Logo" width="1200" height="630" class="lazyload" data-proofer-ignore></a><figcaption class="text-center pt-2 pb-2">MongoDB Logo</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://linkedin.com/in/elijahma">Elias Amha</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1836 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p>As many before me, I was introduced to database systems in university, with a relational DBMS. I learned about normalization, transactions, ACID … the list goes on. So when I first heard of this mystical thing called a document database, which didn’t use SQL, which very publicly denounced normalization, I was a bit skeptical. How could a document database be better than a relational database? After all, relational databases have been around for a very long time, and have been used to build some of the most complex systems in the world. I thought it was just a fad, and that it would die out soon. But, oh boy, was I wrong. After working with mongo for a while, I have come to appreciate its simplicity and flexibility. In this post, I will try to recap a bit on database systems and start to delve into optimization tips and tricks for mongo.</p><h2 id="relational-vs-document-databases"><span class="mr-2">Relational vs document databases</span><a href="#relational-vs-document-databases" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Relational databases store data in tables, where each row represents an entity, and each column represents an attribute of the entity. Each table is defined by a schema, which specifies the name of the table, and the name, type, and constraints of the columns. Basically, you can visualize relational databases as a spreadsheet, where each row is a record, and each column is a field.</p><p>Document databases on the other hand, store data in documents, which are similar to JSON objects. Each document represents an entity, and each field represents an attribute of the entity. The documents are stored in collections, which are similar to tables. Collections, however, do not have a schema. This means that the documents in a collection do not need to have the same fields, and the fields do not need to have the same type. In the case of document databases, you can imagine each document is a json file. and a collection is a folder.</p><p>Mongo is a document database, plain and simple. To the best of my knowledge, it is by far the most popular document database out there. It is also the database I have the most experience with, so I will be focusing on mongo in this post. However, the concepts I will be talking about are applicable to other document databases as well.</p><h2 id="benchmarking"><span class="mr-2">Benchmarking</span><a href="#benchmarking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Before we can get started to improve performaces, we need to have a baseline to compare against. To do this, first we need to have a dataset to work with. I have went along and created two collections,</p><ol><li>Person</ol><div class="table-wrapper"><table><thead><tr><th>Field<th>Type<tbody><tr><td>_id<td>ObjectId<tr><td>name<td>String<tr><td>age<td>Number<tr><td>birthdate<td>Date<tr><td>hobbies<td>Array<tr><td>job<td>ObjectId</table></div><ol><li>Job</ol><div class="table-wrapper"><table><thead><tr><th>Field<th>Type<tbody><tr><td>_id<td>ObjectId<tr><td>name<td>String<tr><td>salary<td>Number<tr><td>description<td>String</table></div><p>I have seeded the database with around 100,000 (133,553 to be exact) documents in the person collection, and 20,000 documents in the job collection.</p><p>Now we can create a simple wrapper to the mongo client to simplify the benchmarking process, and also to include custom export of the perfomance to create graphs based on them.</p><p>Lets start with planning a simple benchmarking wrapper.</p><p>What it needs to do is:</p><ol><li>Accept a query we’d like to benchmark<li>Get the execution plan for the query<li>Run the actual query and get the execution time<li>Return the benchmark results</ol><p>To make the code look a bit cleaner and nearly similar to regular mongo queries, we can create a proxy object that will wrap the mongo client and return the benchmark results when we call one of the operation methods. Let’s start by defining a const that will hold the name of operations we want to benchmark.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">_BENCHMARK_METHODS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="dl">"</span><span class="s2">aggregate</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">count</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">distinct</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">find</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">findOne</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">findOneAndDelete</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">findOneAndReplace</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">findOneAndUpdate</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">insertMany</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">insertOne</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">replaceOne</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">updateMany</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">updateOne</span><span class="dl">"</span><span class="p">,</span>
<span class="p">];</span>
</pre></table></code></div></div><p>Now we can create the proxy object. We will use the Proxy object to intercept calls to the mongo client and return the benchmark results when we call one of the operation methods.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">benchmarkProxy</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">get</span><span class="p">:</span> <span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// if the property is one of the benchmark methods</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">_BENCHMARK_METHODS</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">property</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// run the benchmark here</span>
      <span class="k">return</span> <span class="nx">functionThatRunsTheBenchmark</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// return the original mongo client method</span>
    <span class="k">return</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></table></code></div></div><p>That’s a good skeleton for the proxy object. Now we can start filling in the details.</p><p>First, we need to implement <code class="language-plaintext highlighter-rouge">functionThatRunsTheBenchmark</code> . This function will accept the query we want to benchmark, and return the benchmark results.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">benchmarkProxy</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">get</span><span class="p">:</span> <span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// if the property is one of the benchmark methods</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">_BENCHMARK_METHODS</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">property</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">async </span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// run the benchmark here and return the results</span>
        <span class="c1">// we have access to</span>
        <span class="c1">// - target: the mongo client</span>
        <span class="c1">// - property: the name of the method we are calling (eg. find)</span>
        <span class="c1">// - query: the query we are passing to the method (eg. { name: "John" })</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="c1">// return the original mongo client method</span>
    <span class="k">return</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Using the above skeleton, we can start implementing the benchmarking function. We can start by getting the execution plan for the query.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">benchmarkProxy</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">get</span><span class="p">:</span> <span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// if the property is one of the benchmark methods</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">_BENCHMARK_METHODS</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">property</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// run the benchmark here</span>
      <span class="k">return</span> <span class="k">async </span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>


        <span class="c1">// get the execution plan</span>
        <span class="kd">const</span> <span class="nx">executionPlan</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">](</span><span class="nx">query</span><span class="p">).</span><span class="nf">explain</span><span class="p">(</span>
          <span class="dl">"</span><span class="s2">executionStats</span><span class="dl">"</span>
        <span class="p">);</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="nx">executionPlan</span><span class="p">,</span>
        <span class="p">};</span>

    <span class="p">}</span>
    <span class="c1">// return the original mongo client method</span>
    <span class="k">return</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Now we can run the actual query and get the execution time.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">benchmarkProxy</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">get</span><span class="p">:</span> <span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// if the property is one of the benchmark methods</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">_BENCHMARK_METHODS</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">property</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// run the benchmark here</span>
      <span class="k">return</span> <span class="k">async </span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// get the execution plan</span>
        <span class="kd">const</span> <span class="nx">executionPlan</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">](</span><span class="nx">query</span><span class="p">).</span><span class="nf">explain</span><span class="p">(</span>
          <span class="dl">"</span><span class="s2">executionStats</span><span class="dl">"</span>
        <span class="p">);</span>

        <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">();</span>
        <span class="k">await</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">](</span><span class="nx">query</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">();</span>
        <span class="kd">const</span> <span class="nx">executionTime</span> <span class="o">=</span> <span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">;</span>

        <span class="k">return</span> <span class="p">{</span>
          <span class="nx">executionPlan</span><span class="p">,</span>
          <span class="nx">executionTime</span><span class="p">,</span>
        <span class="p">};</span>
    <span class="p">}</span>
    <span class="c1">// return the original mongo client method</span>
    <span class="k">return</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Our benchmarking function is now looking good enough. We can now create a factory function that we can use to inject the mongo collection we want to benchmark. This will allow us to create multiple benchmarking functions for different collections.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">const</span> <span class="nx">benchmarkFactory</span> <span class="o">=</span> <span class="p">(</span><span class="nx">collection</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nc">Proxy</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">benchmarkProxy</span><span class="p">);</span>
<span class="p">};</span>
</pre></table></code></div></div><p>As a final touch, lets allow the benchmarking function to accept a configuration object that will allow us to customize the benchmarking process. For example, we can allow the user to specify the number of times to run the query. We can expand on this later to allow the user to specify other options.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">export</span> <span class="kd">const</span> <span class="nx">benchmarkFactory</span> <span class="o">=</span> <span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="p">{</span> <span class="nx">iterations</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
  <span class="nx">collection</span><span class="p">.</span><span class="nx">_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">iterations</span><span class="p">,</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nc">Proxy</span><span class="p">(</span><span class="nx">collection</span><span class="p">,</span> <span class="nx">benchmarkProxy</span><span class="p">);</span>
<span class="p">};</span>
</pre></table></code></div></div><p>And modify the benchmarking function to use the configuration.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">benchmarkProxy</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">get</span><span class="p">:</span> <span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">property</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// if the property is one of the benchmark methods</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">_BENCHMARK_METHODS</span><span class="p">.</span><span class="nf">includes</span><span class="p">(</span><span class="nx">property</span><span class="p">))</span> <span class="p">{</span>
      <span class="c1">// run the benchmark here</span>
      <span class="k">return</span> <span class="k">async </span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// get the execution plan</span>
        <span class="kd">const</span> <span class="nx">explainerClient</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">target</span><span class="p">.</span><span class="nf">explain</span><span class="p">(</span><span class="dl">"</span><span class="s2">executionStats</span><span class="dl">"</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">executionPlan</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">explainerClient</span><span class="p">[</span><span class="nx">property</span><span class="p">](</span><span class="nx">query</span><span class="p">);</span>

        <span class="c1">// run the query and get the execution time</span>
        <span class="kd">const</span> <span class="nx">elapsedTimes</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for </span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">target</span><span class="p">.</span><span class="nx">_config</span><span class="p">.</span><span class="nx">iterations</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">();</span>
          <span class="k">await</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">](</span><span class="nx">query</span><span class="p">);</span>
          <span class="kd">const</span> <span class="nx">end</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">();</span>
          <span class="nx">elapsedTimes</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">end</span> <span class="o">-</span> <span class="nx">start</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// we can now get a better estimate of the execution time</span>
        <span class="kd">const</span> <span class="nx">slowestTime</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">max</span><span class="p">(...</span><span class="nx">elapsedTimes</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">fastestTime</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nf">min</span><span class="p">(...</span><span class="nx">elapsedTimes</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">averageTime</span> <span class="o">=</span> <span class="nx">elapsedTimes</span><span class="p">.</span><span class="nf">reduce</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">)</span> <span class="o">/</span> <span class="nx">elapsedTimes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

        <span class="k">return</span> <span class="p">{</span>
          <span class="nx">executionPlan</span><span class="p">,</span>
          <span class="nx">executionTime</span><span class="p">,</span>
        <span class="p">};</span>
    <span class="p">}</span>
    <span class="c1">// return the original mongo client method</span>
    <span class="k">return</span> <span class="nx">target</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
  <span class="p">},</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Amazing! We now have a simple benchmarking function that we can use to benchmark our queries. We can now use this function to benchmark our queries and get the execution plan and execution time.</p><div class="language-js highlighter-rouge"><div class="code-header"> <span data-label-text="JavaScript"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">MongoClient</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">mongodb</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">benchmarkFactory</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">./benchmark</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">mongoUrl</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">mongodb://localhost:27017</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MongoClient</span><span class="p">(</span><span class="nx">mongoUrl</span><span class="p">);</span>
<span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nf">connect</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">db</span><span class="p">(</span><span class="dl">"</span><span class="s2">test</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">jobsCollection</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">collection</span><span class="p">(</span><span class="dl">"</span><span class="s2">jobs</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">benchmarkedJobsCollection</span> <span class="o">=</span> <span class="nf">benchmarkFactory</span><span class="p">(</span><span class="nx">jobsCollection</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">iterations</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">benchmarkedJobsCollection</span><span class="p">.</span><span class="nf">find</span><span class="p">({});</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
</pre></table></code></div></div><p>The above test yields the output</p><pre><code class="language-`json">{
  "executionPlan": {
    "queryPlanner": {
      "plannerVersion": 1,
      "namespace": "test.jobs",
      "indexFilterSet": false,
      "parsedQuery": {},
      "winningPlan": {
        "stage": "COLLSCAN",
        "direction": "forward"
      },
      "rejectedPlans": []
    },
    "executionStats": {
      "executionSuccess": true,
      "nReturned": 20060,
      "executionTimeMillis": 5,
      "totalKeysExamined": 0,
      "totalDocsExamined": 20060,
      "executionStages": {
        "stage": "COLLSCAN",
        "nReturned": 20060,
        "executionTimeMillisEstimate": 2,
        "works": 20062,
        "advanced": 20060,
        "needTime": 1,
        "needYield": 0,
        "saveState": 20,
        "restoreState": 20,
        "isEOF": 1,
        "direction": "forward",
        "docsExamined": 20060
      }
    },
    "serverInfo": {
      "host": "joeking-pee-cee",
      "port": 27017,
      "version": "4.4.5",
      "gitVersion": "ff5cb77101b052fa02da43b8538093486cf9b3f7"
    },
    "ok": 1,
    "$clusterTime": {
      "clusterTime": {
        "$timestamp": "7147275551382700033"
      },
      "signature": {
        "hash": "AAAAAAAAAAAAAAAAAAAAAAAAAAA=",
        "keyId": 0
      }
    },
    "operationTime": {
      "$timestamp": "7147275551382700033"
    }
  },
  "executionTime": {
    "slowestTime": 118,
    "fastestTime": 67,
    "averageTime": 76.8
  }
}
</code></pre><p>For now, focus only on the <code class="language-plaintext highlighter-rouge">executionTime</code> object (at the bottom of the output). This is the execution time of the query. We can see that the slowest time is 118ms, the fastest time is 67ms and the average time is 76.8ms. We can use this information to generalize that about 20000 documents are being returned in 70-80ms. Ofcause, this is just a rough estimate and there are a lot of factors at play like the processing power of the machine, the size of the documents, etc. But this is a good start.</p><p>I know, I know that is an overwhelming amount of information, plus a lot of work for a simple query. But trust me, it will pay off later in this series. We will use this information to optimize our queries.</p><p>This turned out to be a long post. I will try to keep the next post shorter. In the next post, we will look at some of the common bottlenecks we can encounter when querying MongoDB and how we can avoid them.</p><p>If you have any questions or comments, please leave them in the comments section below. If you found this post useful, please share it with your friends and colleagues. If you want to be notified when I publish a new post, follow me on LinkedIn where I post updates about my blog posts.</p><h4 id="thanks-for-reading"><span class="mr-2">Thanks for reading!</span><a href="#thanks-for-reading" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/mongodb/'>MongoDB</a>, <a href='//categories/optimization/'>Optimization</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/mongo/" class="post-tag no-text-decoration" >mongo</a> <a href="//tags/nosql/" class="post-tag no-text-decoration" >nosql</a> <a href="//tags/optimization/" class="post-tag no-text-decoration" >optimization</a> <a href="//tags/mongodb/" class="post-tag no-text-decoration" >mongodb</a> <a href="//tags/mongodb-optimization/" class="post-tag no-text-decoration" >mongodb-optimization</a> <a href="//tags/series-1/" class="post-tag no-text-decoration" >series-1</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=MongoDB%20Optimization%20Part%201%20-%20A%20Scuba%20Blog%20by%200xecho&url=https%3A%2F%2Fblog.echo.et%2Fposts%2Fmongodb-optimization-part-1%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=MongoDB%20Optimization%20Part%201%20-%20A%20Scuba%20Blog%20by%200xecho&u=https%3A%2F%2Fblog.echo.et%2Fposts%2Fmongodb-optimization-part-1%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fblog.echo.et%2Fposts%2Fmongodb-optimization-part-1%2F&text=MongoDB%20Optimization%20Part%201%20-%20A%20Scuba%20Blog%20by%200xecho" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/failing-to-automate-part-1/">Failing to automate - GitLab merge requests</a><li><a href="/posts/just-migrated-my-blog/">Just Migrated my Blog</a><li><a href="/posts/mongodb-optimization-part-1/">MongoDB Optimization Part 1</a><li><a href="/posts/how-not-to-center-a-div/">How not to center a div</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/mongo/">mongo</a> <a class="post-tag" href="/tags/mongodb-optimization/">mongodb-optimization</a> <a class="post-tag" href="/tags/mongodb/">mongodb</a> <a class="post-tag" href="/tags/nosql/">nosql</a> <a class="post-tag" href="/tags/optimization/">optimization</a> <a class="post-tag" href="/tags/series-1/">series-1</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/centering/">centering</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mongodb-optimization-part-2/"><div class="card-body"> <em class="small" data-ts="1666421640" data-df="ll" > Oct 22, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MongoDB Optimization Part 2</h3><div class="text-muted small"><p> On the last … In the previous post, we looked at how we can benchmark our queries to get an idea of how fast they are. We also looked at how we can get the execution plan of our queries. In this p...</p></div></div></a></div><div class="card"> <a href="/posts/failing-to-automate-part-1/"><div class="card-body"> <em class="small" data-ts="1667736000" data-df="ll" > Nov 6, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Failing to automate - GitLab merge requests</h3><div class="text-muted small"><p> Hello friend, after a long time, I am back with a new blog post. This time, I am getting sidetracked again and am writing about something different. I am going to talk about Gitlab and how I automa...</p></div></div></a></div><div class="card"> <a href="/posts/how-not-to-center-a-div/"><div class="card-body"> <em class="small" data-ts="1664755200" data-df="ll" > Oct 3, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How not to center a div</h3><div class="text-muted small"><p> How not to center a div Ever struggled to center a div? Ever googled “how to center a div”? You probably have seen a lot of different ways to center a div. I even googled “how to center a div” and...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/just-migrated-my-blog/" class="btn btn-outline-primary" prompt="Older"><p>Just Migrated my Blog</p></a> <a href="//posts/how-not-to-center-a-div/" class="btn btn-outline-primary" prompt="Newer"><p>How not to center a div</p></a></div><script src="https://utteranc.es/client.js" repo="0xecho/blog-comments" issue-term="pathname" crossorigin="anonymous" async> </script> <script type="text/javascript"> $(function() { const origin = "https://utteranc.es"; const iframe = "iframe.utterances-frame"; const lightTheme = "github-light"; const darkTheme = "github-dark"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } addEventListener("message", (event) => { let theme; /* credit to <https://github.com/utterance/utterances/issues/170#issuecomment-594036347> */ if (event.origin === origin) { /* page initial */ theme = initTheme; } else if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); } else { return; } const message = { type: "set-theme", theme: theme }; const utterances = document.querySelector(iframe).contentWindow; utterances.postMessage(message, origin); }); }); </script></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/mongo/">mongo</a> <a class="post-tag" href="/tags/mongodb-optimization/">mongodb-optimization</a> <a class="post-tag" href="/tags/mongodb/">mongodb</a> <a class="post-tag" href="/tags/nosql/">nosql</a> <a class="post-tag" href="/tags/optimization/">optimization</a> <a class="post-tag" href="/tags/series-1/">series-1</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/bash/">bash</a> <a class="post-tag" href="/tags/blog/">blog</a> <a class="post-tag" href="/tags/centering/">centering</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://linkedin.com/in/elijahma">Elias Amha</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-5V4XHL1MJ1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-5V4XHL1MJ1'); }); </script>
